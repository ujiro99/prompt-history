# UI/UX フロー設計

## 概要

プロンプト自動整理機能のUI/UX設計。
ユーザーが安心して利用でき、整理結果を分かりやすく理解できることを重視する。

---

## 1. 画面遷移図

```
[Settings Menu]
  ↓ (プロンプト整理設定を開く)
[OrganizerSettingsDialog] ① 設定ダイアログ
  ↓ (整理するボタン押下)
[ローディング表示]
  ↓ (Gemini API 完了)
[OrganizerSummaryDialog] ② サマリダイアログ
  ↓ (プレビューを見るボタン押下)
[OrganizerPreviewDialog] ③ プレビューダイアログ
  ↓ (保存ボタン押下)
[完了通知]
  ↓
[Pinned Menu] ④ セクションB に新規テンプレート表示
```

---

## 2. ① 設定ダイアログ (OrganizerSettingsDialog)

### 2.1 レイアウト

```
┌────────────────────────────────────────────────────┐
│ プロンプト自動整理                            [×]  │
├────────────────────────────────────────────────────┤
│                                                    │
│ 🔧 絞り込み条件                                    │
│ ┌────────────────────────────────────────────┐     │
│ │ 最終実行時期:  [1週間 ▼] [1ヶ月] [1年]     │     │
│ │                                            │     │
│ │ 最低実行回数:  [___2___] 回以上            │     │
│ │                                            │     │
│ │ 読み込み件数:  [__100__] 件                │     │
│ └────────────────────────────────────────────┘     │
│                                                    │
│ 📝 整理用プロンプト                                │
│ ┌────────────────────────────────────────────┐     │
│ │ あなたはプロンプト整理の専門家です。       │     │
│ │ ユーザーの過去のプロンプト履歴から、       │     │
│ │ 再利用可能なテンプレートを作成して...      │     │
│ │                                            │     │
│ │ [編集可能なテキストエリア]                 │     │
│ └────────────────────────────────────────────┘     │
│ [デフォルトに戻す]                                 │
│                                                    │
│ 📊 実行想定                                        │
│ ┌────────────────────────────────────────────┐     │
│ │ 対象プロンプト: 42件                       │     │
│ │                                            │     │
│ │ 想定トークン数: 15,234 tokens              │     │
│ │                                            │     │
│ │ コンテキスト使用率:                        │     │
│ │ [████████░░░░░░░░░░] 12.3%                 │     │
│ │                                            │     │
│ │ 概算コスト: ¥2.5 / 回 (参考)               │     │
│ └────────────────────────────────────────────┘     │
│                                                    │
│                        [キャンセル] [整理する]     │
└────────────────────────────────────────────────────┘
```

### 2.2 インタラクション

**絞り込み条件変更時**:

- リアルタイムで「実行想定」セクションを更新
- デバウンス処理（500ms）で API 負荷を軽減
- トークン数が上限を超える場合は警告表示

**整理するボタン**:

- 条件が有効な場合のみ有効化
- 押下後、ローディングスピナー表示
- Gemini API 呼び出し中は他の操作をブロック

**整理用プロンプトの編集**:

- Textarea で自由編集可能
- 「デフォルトに戻す」ボタンでプリセットに復元

### 2.3 バリデーション

- 最低実行回数: 0 〜 100
- 読み込み件数: 10 〜 1000
- トークン数が上限（200万）を超える場合はエラー

---

## 3. ② サマリダイアログ (OrganizerSummaryDialog)

### 3.1 レイアウト

```
┌────────────────────────────────────────────────────┐
│ ✨ プロンプトを自動整理しました                [×] │
├────────────────────────────────────────────────────┤
│                                                    │
│ 📈 整理結果                                        │
│ ┌────────────────────────────────────────────┐     │
│ │ • 新しいテンプレート: 3件                  │     │
│ │ • 対象: 過去30日 / 42件のプロンプト        │     │
│ │ • コスト: ¥2.5                             │     │
│ └────────────────────────────────────────────┘     │
│                                                    │
│ 🌟 おすすめテンプレート                            │
│ ┌────────────────────────────────────────────┐     │
│ │ 「取引先へ謝罪メールを作成」               │     │
│ │ ────────────────────────────────           │     │
│ │ 対象: 7件のプロンプトから作成              │     │
│ │                                            │     │
│ │ よく使っている '取引先へのメール' パターン │     │
│ │ を、変数付きテンプレートとして1件作成      │     │
│ │ しました。今後、取引先へのメールはこの     │     │
│ │ テンプレートから数クリックで呼び出せます。 │     │
│ │                                            │     │
│ │ [このテンプレートを試す →]                 │     │
│ └────────────────────────────────────────────┘     │
│                                                    │
│                 [すべて保存] [プレビューを見る]    │
└────────────────────────────────────────────────────┘
```

### 3.2 インタラクション

**このテンプレートを試す**:

- 該当テンプレートの変数入力ダイアログを開く
- 即座に利用できる成功体験を提供

**すべて保存**:

- 全テンプレートを一括で保存
- `showInPinned = true` で Pinned セクションB に表示
- 保存後、完了通知を表示

**プレビューを見る**:

- プレビューダイアログに遷移
- 個別に編集・選択が可能

### 3.3 ストーリー化

代表的な1件を強調表示し、以下の要素でストーリーを構築：

- **タイトル**: 簡潔なユースケース
- **元件数**: 「7件のプロンプトから作成」
- **ナラティブ**: 「よく使っている...」という説明文
- **行動促進**: 「このテンプレートを試す」ボタン

---

## 4. ③ プレビューダイアログ (OrganizerPreviewDialog)

### 4.1 レイアウト（2ペイン構成）

```
┌────────────────────────────────────────────────────────────────────┐
│ テンプレートのプレビュー                                      [×]  │
├──────────────────┬─────────────────────────────────────────────────┤
│ 左ペイン         │ 右ペイン                                        │
│                  │                                                 │
│ ┌──────────────┐ │ テンプレート名:                                 │
│ │🌟 取引先への │ │ [取引先へ謝罪メールを作成_______________]       │
│ │   謝罪メール │ │                                                 │
│ │   (7件)      │ │ ユースケース:                                   │
│ │              │ │ [取引先へ謝罪のメールを作る_____________]       │
│ │              │ │                                                 │
│ └──────────────┘ │ カテゴリ:                                       │
│ ┌──────────────┐ │ [対外コミュニケーション ▼]                      │
│ │  社内報告書  │ │                                                 │
│ │  作成        │ │ テンプレート本文:                               │
│ │  (12件)      │ │ ┌─────────────────────────────────────────┐     │
│ │              │ │ │ 件名: {{subject}} のご報告とお詫び      │     │
│ └──────────────┘ │ │                                         │     │
│ ┌──────────────┐ │ │ {{client_name}}様                       │     │
│ │  議事録作成  │ │ │                                         │     │
│ │  (5件)       │ │ │ 平素より大変お世話になっております。    │     │
│ │              │ │ │ この度は {{issue}} につきまして、       │     │
│ └──────────────┘ │ │ 多大なるご迷惑をおかけし...             │     │
│                  │ │                                         │     │
│                  │ │ [変数は {{...}} でハイライト]           │     │
│                  │ └─────────────────────────────────────────┘     │
│                  │                                                 │
│                  │ 抽出された変数:                                 │
│                  │ • {{subject}}: 報告対象の件名                   │
│                  │ • {{client_name}}: 取引先名                     │
│                  │ • {{issue}}: 発生した問題                       │
│                  │                                                 │
│                  │ > 元になったプロンプト例を表示 (2件)            │
│                  │                                                 │
│                  │                                                 │
│                  │ [保存しない] [保存] [保存してお気に入り]    │
└──────────────────┴─────────────────────────────────────────────────┘
```

### 4.2 インタラクション

**左ペイン: テンプレート一覧**:

- クリックで選択（ハイライト表示）
- テンプレート名とソース件数を表示
- 🌟アイコンで AI 生成を視覚化

**右ペイン: 詳細表示・編集**:

- テンプレート名: 編集可能（20文字以内）
- ユースケース: 編集可能（40文字以内）
- カテゴリ: プルダウンで選択
  - 既存カテゴリ一覧
  - 「+ 新しいカテゴリを追加」オプション
- テンプレート本文: 読み取り専用（変数部分をハイライト）
- 変数一覧: 名前と説明を表示

**元になったプロンプト例**:

- Collapse（折りたたみ）で 2〜3件を表示
- プロンプトの全文を確認可能

**アクションボタン**:

- **保存しない**: `userAction = 'discard'`、次のテンプレートに移動
- **保存**: `userAction = 'save'`、ストレージに保存
- **保存してお気に入り**: `userAction = 'save_and_pin'`、保存＋ピン留め

### 4.3 バリデーション

- テンプレート名: 必須、20文字以内
- ユースケース: 必須、40文字以内
- カテゴリ: 選択必須

---

## 5. ④ Pinned Menu のセクション表示

### 5.1 セクション分割レイアウト

```
┌────────────────────────────────────────┐
│ 📌 Pinned                        [×]  │
├────────────────────────────────────────┤
│                                        │
│ 🙋 あなたのピン留め                    │
│ ┌────────────────────────────────┐     │
│ │ ⭐ よく使うプロンプト1         │     │
│ │   "プロジェクト報告書を..."    │     │
│ └────────────────────────────────┘     │
│ ┌────────────────────────────────┐     │
│ │ ⭐ よく使うプロンプト2         │     │
│ │   "週次レポートを作成..."      │     │
│ └────────────────────────────────┘     │
│                                        │
│ ✨ AIのおすすめテンプレ                │
│ ┌────────────────────────────────┐     │
│ │ 🌟 取引先へ謝罪メールを作成    │ (新規キラキラ)
│ │   「取引先へ謝罪のメールを...」│     │
│ └────────────────────────────────┘     │
│ ┌────────────────────────────────┐     │
│ │ 🌟 社内報告書作成              │     │
│ │   「目標達成と顧客から...」    │     │
│ └────────────────────────────────┘     │
│ ┌────────────────────────────────┐     │
│ │ 🌟 議事録作成                  │     │
│ │   「チームへすぐにTODOを...」  │     │
│ └────────────────────────────────┘     │
│                                        │
└────────────────────────────────────────┘
```

### 5.2 セクションヘッダー

**セクションA: 「🙋 あなたのピン留め」**

- ユーザーが手動でピンしたプロンプト
- 通常の星アイコン（⭐）

**セクションB: 「✨ AIのおすすめテンプレ」**

- AI 自動作成かつ `showInPinned === true` のプロンプト
- AIアイコン（🌟）で区別

### 5.3 新規未確認の装飾

**未確認状態（`aiMetadata.confirmed === false`）**:

```css
/* グラデーション背景 */
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

/* キラキラアニメーション */
@keyframes shimmer {
  0% {
    background-position: -200% center;
  }
  100% {
    background-position: 200% center;
  }
}

background-size: 200% 100%;
animation: shimmer 3s ease-in-out infinite;
```

**確認済み状態（`confirmed === true`）**:

- 通常の背景色
- アニメーションなし
- 引き続き 🌟 アイコンで AI 生成を示す

### 5.4 Pinned トリガーアイコンの装飾

**未確認テンプレートが存在する場合**:

```
[🌟] ← Pinned トリガーに同様のキラキラ装飾
```

- Pinned Menu のトリガー自体にもキラキラアニメーション
- ユーザーの注意を引き、新規テンプレートの存在を知らせる

---

## 6. ユーザー確認フロー

### 6.1 確認済みへの遷移

```
[AI自動作成プロンプト]
  confirmed: false
  ↓
[ユーザーがクリック または 実行]
  ↓
aiMetadata.confirmed = true に更新
  ↓
キラキラアニメーション解除
  ↓
通常表示（引き続きセクションBに表示）
```

### 6.2 ピン昇格フロー

```
[セクションB: AIおすすめテンプレ]
  ↓
[右クリック → 「お気に入りに追加」]
  ↓
isPinned = true に更新
  ↓
[セクションA: あなたのピン留め] に移動
```

---

## 7. 通知・フィードバック

### 7.1 完了通知

**整理完了時**:

```
┌────────────────────────────────────┐
│ ✅ 3件のテンプレートを保存しました  │
│    「AIのおすすめテンプレ」で      │
│    確認できます                    │
└────────────────────────────────────┘
```

- 画面右下にトースト通知
- 3秒後に自動で消える

**保存後の Pinned リスト表示時**:

```
┌────────────────────────────────────┐
│ 📣 新しく '社内報告用' テンプレート │
│    2件を追加しました               │
└────────────────────────────────────┘
```

- セクションB の上部に一時的なメッセージバナー
- 「×」で閉じるまで表示

### 7.2 エラー表示

**Gemini API エラー**:

```
┌────────────────────────────────────┐
│ ❌ プロンプトの整理に失敗しました   │
│                                    │
│ Gemini API からエラーが返されました│
│ 設定を見直して再度お試しください   │
│                                    │
│ [閉じる]                           │
└────────────────────────────────────┘
```

**ネットワークエラー**:

```
┌────────────────────────────────────┐
│ ⚠️ ネットワークエラー               │
│                                    │
│ インターネット接続を確認して       │
│ 再度お試しください                 │
│                                    │
│ [再試行] [閉じる]                  │
└────────────────────────────────────┘
```

---

## 8. レスポンシブ対応

### 8.1 ダイアログのサイズ

- **設定ダイアログ**: 固定幅 600px、可変高さ
- **サマリダイアログ**: 固定幅 500px、可変高さ
- **プレビューダイアログ**: 固定幅 900px、可変高さ
  - 画面が狭い場合は 2ペインを縦並びに変更（700px以下）

### 8.2 モバイル対応

現時点ではデスクトップのみを想定（Chrome 拡張機能の性質上）。
将来的にモバイルブラウザに対応する場合は、以下を検討：

- プレビューダイアログを全画面表示
- 2ペインを縦スクロール可能に変更

---

## 9. アクセシビリティ

### 9.1 キーボード操作

- **Tab**: フォーカス移動
- **Enter**: ボタン実行
- **Esc**: ダイアログを閉じる
- **↑↓**: テンプレート一覧の選択移動

### 9.2 ARIA 属性

```tsx
<Dialog role="dialog" aria-labelledby="dialog-title">
  <h2 id="dialog-title">プロンプト自動整理</h2>
  {/* ... */}
</Dialog>

<Button aria-label="整理を実行">整理する</Button>

<ProgressBar
  role="progressbar"
  aria-valuenow={contextUsageRate * 100}
  aria-valuemin={0}
  aria-valuemax={100}
>
```

### 9.3 スクリーンリーダー対応

- すべてのボタンに `aria-label` を付与
- 状態変化（ローディング、エラー）を `aria-live` で通知
- フォームフィールドに `label` を関連付け

---

## 10. パフォーマンス

### 10.1 レンダリング最適化

- 大量のテンプレート候補（10件以上）の場合、Virtualization を検討
- 左ペインのリストは `React.memo` でメモ化
- 右ペインの詳細表示は選択変更時のみ再レンダリング

### 10.2 アニメーション

- キラキラアニメーションは CSS のみで実装（JS 不使用）
- `will-change: transform` でパフォーマンス最適化
- 60fps を維持

---

## 11. 国際化 (i18n)

すべてのテキストを `i18n.t()` で管理。

### 11.1 追加する翻訳キー

```yaml
# en.yml
organizer:
  settingsTitle: "Prompt Organizer Settings"
  filterPeriod: "Period"
  filterExecutionCount: "Min execution count"
  filterMaxPrompts: "Max prompts to load"
  organizationPrompt: "Organization prompt"
  resetToDefault: "Reset to default"
  executionEstimate: "Execution estimate"
  targetPrompts: "Target prompts"
  estimatedTokens: "Estimated tokens"
  contextUsage: "Context usage"
  estimatedCost: "Estimated cost"
  execute: "Organize"
  summaryTitle: "Prompts organized successfully"
  templatesCreated: "New templates created"
  sourceInfo: "Source: {days} days / {count} prompts"
  previewTitle: "Template preview"
  sectionUserPinned: "Your pinned"
  sectionAIRecommended: "AI recommendations"
  category:
    externalCommunication: "External Communication"
    externalCommunicationDesc: "Communication with clients and customers"
    internalCommunication: "Internal Communication"
    internalCommunicationDesc: "Team communication and internal reports"
    documentCreation: "Document Creation"
    documentCreationDesc: "Reports, proposals, articles, etc."
    development: "Development & Tech"
    developmentDesc: "Code, technical research, design, etc."
    other: "Other"
    otherDesc: "Prompts that don't fit other categories"
  # ... その他
```

```yaml
# ja.yml
organizer:
  settingsTitle: "プロンプト自動整理"
  filterPeriod: "最終実行時期"
  filterExecutionCount: "最低実行回数"
  filterMaxPrompts: "読み込み件数"
  organizationPrompt: "整理用プロンプト"
  resetToDefault: "デフォルトに戻す"
  executionEstimate: "実行想定"
  targetPrompts: "対象プロンプト"
  estimatedTokens: "想定トークン数"
  contextUsage: "コンテキスト使用率"
  estimatedCost: "概算コスト"
  execute: "整理する"
  summaryTitle: "プロンプトを自動整理しました"
  templatesCreated: "新しいテンプレート"
  sourceInfo: "対象: 過去{days}日 / {count}件"
  previewTitle: "テンプレートのプレビュー"
  sectionUserPinned: "あなたのピン留め"
  sectionAIRecommended: "AIのおすすめテンプレ"
  category:
    externalCommunication: "対外コミュニケーション"
    externalCommunicationDesc: "取引先や顧客とのやり取り"
    internalCommunication: "社内コミュニケーション"
    internalCommunicationDesc: "チーム内や社内報告"
    documentCreation: "ドキュメント作成"
    documentCreationDesc: "報告書、提案書、記事など"
    development: "開発・技術"
    developmentDesc: "コード、技術調査、設計など"
    other: "その他"
    otherDesc: "上記以外のプロンプト"
  # ... その他
```

---

## 12. デザインシステム

既存の Shadcn/ui コンポーネントと Tailwind CSS を活用。

### 12.1 使用するコンポーネント

- `Dialog`, `DialogContent`, `DialogHeader`, `DialogFooter`
- `Button`
- `Input`, `Textarea`
- `Select`, `SelectTrigger`, `SelectContent`
- `Progress` (コンテキスト使用率バー)
- `Badge` (AI アイコン、件数表示)
- `Collapse` (元プロンプト例の折りたたみ)
- `Tabs` (将来的な拡張用)

### 12.2 カラーパレット

- **AI 生成の強調**: グラデーション `#667eea` → `#764ba2`
- **警告**: `text-yellow-600`
- **エラー**: `text-red-600`
- **成功**: `text-green-600`
- **通常**: `text-neutral-600`

---

## 13. まとめ

UI/UX 設計のポイント：

1. **安心感**: 常にコスト・トークン数を可視化
2. **透明性**: プレビュー画面で内容を確認してから保存
3. **ストーリー化**: サマリで代表的な1件を強調し、成功体験を演出
4. **視覚的フィードバック**: キラキラアニメーションで新規テンプレートを通知
5. **編集可能性**: ユーザーが自由にテンプレート内容を調整可能
