# プロンプトリスト グルーピング表示機能 設計書

---

## 目的

プロンプトリストの表示においてソート方式に応じたグルーピング機能を提供することで、大量のプロンプトの中から目的のものを効率的に見つけられるようにする。視覚的な分類により、ユーザーの認知負荷を軽減し、プロンプト管理の利便性を向上させる。

## 機能要件

### 1. グルーピング仕様

各ソート方式に対応したグルーピング表示を実装する：

#### 1.1 最近使用順（recent）

- **今日**: 本日実行されたプロンプト
- **昨日**: 前日実行されたプロンプト
- **具体的な日付**: YYYY/MM/DD形式で日付別にグルーピング
- **1週間以内**: まとめて表示
- **1ヶ月以内**: まとめて表示
- **1ヶ月以上**: 1年毎にまとめて表示

#### 1.2 実行回数順（execution）

- **高頻度**: 実行回数20回以上
- **中頻度**: 実行回数5-19回
- **低頻度**: 実行回数1-4回
- **未実行**: 実行回数0回

#### 1.3 名前順（name）

- **アルファベット**: A-Z, a-z
- **数字**: 0-9
- **ひらがな**: あ-ん
- **カタカナ**: ア-ン
- **漢字**: 音読み50音順
- **その他**: 記号等

#### 1.4 コンポジット順（composite）

- **最高スコア**: スコア80以上
- **高スコア**: スコア60-79
- **中スコア**: スコア40-59
- **低スコア**: スコア20-39
- **最低スコア**: スコア0-19

### 2. グループ表示機能

- グループヘッダーの表示
- 各グループ内でのソート順維持
- 空のグループは非表示
- グループの折りたたみ機能（将来的な拡張）

## 技術アーキテクチャ

### 1. 型定義

```typescript
// 新規型定義
export interface PromptGroup {
  label: string
  prompts: Prompt[]
  order: number // グループの表示順序
}

export type GroupingFunction = (prompts: Prompt[]) => PromptGroup[]
```

### 2. グルーピング機能

**配置場所**: `src/utils/promptGrouping.ts`

**主要関数**:

- `groupByRecent(prompts: Prompt[]): PromptGroup[]`
- `groupByExecution(prompts: Prompt[]): PromptGroup[]`
- `groupByName(prompts: Prompt[]): PromptGroup[]`
- `groupByComposite(prompts: Prompt[]): PromptGroup[]`
- `groupPrompts(prompts: Prompt[], sortOrder: SortOrder): PromptGroup[]`

### 3. StorageHelperの拡張

既存の`applySort`メソッドを拡張し、グルーピング情報も含めて返すように変更する：

```typescript
private async applySortAndGroup(prompts: Prompt[]): Promise<PromptGroup[]>
```

### 4. PromptListコンポーネントの修正

- `filteredPrompts`をグループ化された構造に変更
- グループヘッダーコンポーネントの追加
- リスト表示ロジックをグループ対応に修正

## UI/UX設計

### 1. グループヘッダー

- **スタイル**: 背景色を変更し、視覚的に区別
- **フォント**: 小さめのフォントサイズ、グレー系の色
- **配置**: 各グループの上部に表示
- **内容**: グループ名とアイテム数

### 2. 視覚的な区切り

- グループ間の余白調整
- 必要に応じて罫線やシャドウで区切りを強調

### 3. アクセシビリティ

- スクリーンリーダー対応のセマンティックマークアップ
- キーボードナビゲーション対応
- 適切なARIAラベルの設定

## 国際化対応

### 1. 多言語ラベル

`public/_locales/`配下の言語ファイルに追加：

```json
{
  "groups": {
    "today": "今日",
    "yesterday": "昨日",
    "highFrequency": "高頻度",
    "alphabetic": "アルファベット"
  }
}
```

### 2. 日付フォーマット

- 地域設定に応じた日付表示
- `Intl.DateTimeFormat`を使用した国際化対応

## 実装計画

### フェーズ1: 基盤実装

1. 型定義の追加
2. グルーピング機能の実装
3. 単体テストの作成

### フェーズ2: UI統合

1. StorageHelperの拡張
2. PromptListコンポーネントの修正
3. グループヘッダーコンポーネントの実装

### フェーズ3: 完成・テスト

1. スタイリングの適用
2. 国際化対応
3. E2Eテストの追加

## パフォーマンス考慮事項

- グルーピング処理のメモ化
- 大量データに対する効率的なグルーピングアルゴリズム
- 仮想スクロール対応（将来的な拡張）

## 将来的な拡張性

### 1. グルーピング表示の設定

- ユーザー設定でグルーピング表示のON/OFF切り替え
- グループの折りたたみ状態の保存

### 2. カスタムグルーピング

- ユーザー定義のグルーピングルール
- タグベースのグルーピング機能

### 3. 高度な並び替え

- グループ内での複数ソート条件
- ドラッグ&ドロップによるグループ順序変更

## テスト戦略

### 1. 単体テスト

- 各グルーピング関数のテスト
- 日付処理のエッジケーステスト

### 2. 統合テスト

- ソート順とグルーピングの整合性テスト

### 3. E2Eテスト

- グルーピング表示の視覚的確認
- 異なるソート順での動作確認
